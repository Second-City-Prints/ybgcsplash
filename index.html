<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
  <meta name="theme-color" content="">

  <title></title>
	
  <meta name="description" content=""/>
  <meta property="og:title" content=""/>
  <meta property="og:description" content=""/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content=""/>
  <meta property="og:image" content=""/>
  <meta property="og:site_name" content=""/>
  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="" />
  <meta name="twitter:image" content="">
  <meta name="twitter:description" content="">

  <link type="text/css" rel="stylesheet" href="./default.css">
  <script src="https://kit.fontawesome.com/ff46203259.js" crossorigin="anonymous"></script>
</head>

<body>	
  <section id="map">
    <img src="./img/placeholdogo.png" alt="Groove Continental">
    <h2>Side A</h2>
    <div class="roadmap">
      <div class="milestone final" epoch="1645926507000" reveal="">
        <span class="milestone-title">Album Release</span>
        <span class="milestone-body"><a href="" target="_blank" class="listen mbutton">Presave</a></span>
      </div>
    </div>
  </section>

  <section id="home">
    <img src="./img/placeholdogo.png" alt="Groove Continental">
    <div class="links">
      <div class="upperlinks">
        <a href="" target="_blank" class="listen">Presave</a>
        <a href="#tracklist" class="tracklist-button">Tracklist</a>
      </div>
      <div class="lowerlinks">
        <a href="" target="_blank">The Radio Show</a>
        <a href="" target="_blank">Buy the Merch</a>
        <a href="" target="_blank">The Playlist</a>
      </div>
    </div>
  </section>

  <section id="tracklist">
    <h2>TRACKLIST</h2>
    <div></div>
  </section>

  <footer>
      <div class="socials">
        <a target="_blank" href="https://www.facebook.com/yungestbae"><i class="fab fa-facebook" aria-hidden="true"></i></a>
        <a target="_blank" href="https://www.instagram.com/yungbae/"><i class="fab fa-instagram" aria-hidden="true"></i></a>
        <a target="_blank" href="https://twitter.com/yungbae"><i class="fab fa-twitter" aria-hidden="true"></i></a>
        <a target="_blank" href="https://www.youtube.com/yungbae"><i class="fab fa-youtube" aria-hidden="true"></i></a>
        <a target="_blank" href="https://discord.gg/saSRFe7g"><i class="fab fa-discord" aria-hidden="true"></i></a>
        <a target="_blank" href="https://www.tiktok.com/@yungbae?lang=en"><i class="fab fa-tiktok" aria-hidden="true"></i></a>
      </div>
      <a href="https://www.yungbae.com/" target="_blank">yungbae.com</a>
  </footer>

  <script>
    var intervals = []
    function initialize(){
      console.log('init')

      //reinitialize
      document.querySelectorAll('.milestone:not(.final)').forEach(e=> e.remove())
      document.querySelector('#tracklist div').innerHTML = ""
      intervals.forEach(interval => {
        clearInterval(interval)
      })
      intervals = []

      //get content
      fetch('https://yungbaesplash.ksws.workers.dev/').then(res=> res.json().then(data => {
        console.log(data)

        //insert all milestones
        var milestoneHTML = ""
        data.milestones.forEach(milestone => {
          if(milestone.revealTime) {
            //
            if(milestone.content) { //revealed
              milestoneHTML += `
                <div class="milestone">
                  <span class="milestone-title">${milestone.title}</span>
                  <span class="milestone-subtitle">${milestone.subtitle}</span>
                  <div class="milestone-body">${milestone.content}</div>
                </div>
              `            
            } else { //unrevealed but has timer
              milestoneHTML += `
                <div class="milestone covered" epoch="${milestone.revealTime}" reveal="">
                  <span class="milestone-title">COMING SOON</span>
                </div>
              `            
            }
            //
          } else { //empty
              milestoneHTML += `
                <div class="milestone covered">
                  <span class="milestone-title">???</span>
                </div>
              `
          }
        })
        document.querySelector('.roadmap').insertAdjacentHTML('afterbegin', milestoneHTML)

        //insert tracklist, if there is any visible yet
        if(data.tracklist) {
          let tracklist = data.tracklist.split('\n')
          tracklist.forEach(track => {
            document.querySelector('#tracklist div').insertAdjacentHTML('afterbegin', `<span>${track}</span>`)
          })
          document.querySelector('#tracklist').style.display = 'flex'
          document.querySelector('.tracklist-button').style.display = 'inline-block'
        } else {
          document.querySelector('#tracklist').style.display = 'none'
          document.querySelector('.tracklist-button').style.display = 'none'
        }

        //add listen or presave buttons depending on whether the album's out or if presave is available      
        document.querySelectorAll('.listen').forEach(e=>{
          if(data.listen) {
            e.href = data.listen
            e.innerHTML = "LISTEN"
            e.style.display = 'inline-block'
          } else if(data.presave) {
            e.href = data.presave
            e.style.display = 'inline-block'
          } else {
            e.style.display = 'none'
          }
        })

        //set up timers for milestones
        document.querySelectorAll('.milestone[epoch]').forEach(e=>{
          if(Date.now() < Number(e.getAttribute('epoch'))) {
            function SCP_timer() {
                let endtime = new Date(Number(e.getAttribute('epoch')))
                let now = Date.now()

                let diff = endtime - now;
                if(diff <= 0) SCP_timerEnd()

                let days = Math.floor(diff / (1000*60*60*24))
                let hours = Math.floor(diff % (1000*60*60*24) / (1000*60*60))
                let minutes = Math.floor(diff % (1000*60*60)/ (1000*60))
                let seconds = Math.floor(diff % (1000*60) / 1000) 

                e.setAttribute('reveal', `${String(days).padStart(2,'0')}:${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`)
            }

            function SCP_timerEnd() {
                initialize()
            }

            SCP_timer()
            intervals.push(setInterval(SCP_timer,1000))
          }
        })
      }))
    }
  
    initialize()
  </script>
</body>
</html>
